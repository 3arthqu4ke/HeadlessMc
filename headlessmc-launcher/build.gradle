plugins {
    id 'application'
}

def MAIN_CLASS = 'me.earth.headlessmc.launcher.Main'
application {
    mainClass = MAIN_CLASS
}

repositories {
    maven {
        name 'OpenAuthMaven'
        url 'https://litarvan.github.io/maven'
    }
}

run {
    standardInput = System.in
}

configurations {
    includeJarInResources
}

dependencies {
    jarLibsApi project(':headlessmc-api')
    jarLibsApi project(':headlessmc-commons')
    jarLibsApi project(':headlessmc-lwjgl')

    jarLibs group: 'org.ow2.asm', name: 'asm', version: '9.5'
    jarLibs group: 'org.ow2.asm', name: 'asm-tree', version: '9.5'
    jarLibs group: 'com.google.code.gson', name: 'gson', version: '2.10.1'
    jarLibs group: 'fr.litarvan', name: 'openauth', version: '1.1.5'

    includeJarInResources ('net.kunmc.lab:forgecli:1.1.0:all') {
        // this is to make it build, jar will still have legacy classes
        exclude module: 'legacy'
        exclude module: 'asm'
        exclude module: 'asm-tree'
    }

    testImplementation(testFixtures(project(':headlessmc-commons')))
    testImplementation 'org.apache.logging.log4j:log4j-api:2.20.0'
    testImplementation 'org.apache.logging.log4j:log4j-core:2.20.0'

    runtimeOnly configurations.includeJarInResources
}

processResources {
    into('headlessmc') {
        from project(':headlessmc-runtime')['jar']
        from project(':headlessmc-lwjgl')['jar']
        from configurations.includeJarInResources
        rename 'ForgeCLI-(.*)-all.jar', 'forge-cli.jar'
    }
}

jar {
    //noinspection GroovyAssignabilityCheck
    manifest {
        attributes('Main-Class': MAIN_CLASS)
    }

    exclude("module-info.class")
    exclude("META-INF/maven/com.google.code.gson/**")
}
